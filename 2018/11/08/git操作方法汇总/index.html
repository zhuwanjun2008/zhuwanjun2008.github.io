<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="记录技术路上的点滴"><title>Hyperic文章汇总 | 万骏的博客</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.3"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-53873155-2','auto');ga('send','pageview');
</script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Hyperic文章汇总</h1><a id="logo" href="/.">万骏的博客</a><p class="description">记录技术路上的点滴</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Hyperic文章汇总</h1><div class="post-meta">Nov 8, 2018<script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 1.7k</span><span class="post-meta-item-text"> 字</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-hourglass-half"></i><span class="post-count"> 7</span><span class="post-meta-item-text"> 分钟</span></span></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#CentOS-安装-PostgreSQL"><span class="toc-number">1.</span> <span class="toc-text">CentOS 安装 PostgreSQL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CentOS-6-安装步骤"><span class="toc-number">1.1.</span> <span class="toc-text">CentOS 6 安装步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#下载安装rpm文件"><span class="toc-number">1.1.1.</span> <span class="toc-text">下载安装rpm文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#安装PostgreSQL服务"><span class="toc-number">1.1.2.</span> <span class="toc-text">安装PostgreSQL服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#安装PostgreSQL-contrib模块"><span class="toc-number">1.1.3.</span> <span class="toc-text">安装PostgreSQL contrib模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#初始化数据库"><span class="toc-number">1.1.4.</span> <span class="toc-text">初始化数据库</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装后操作"><span class="toc-number">1.2.</span> <span class="toc-text">安装后操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CentOS-7-安装步骤"><span class="toc-number">1.3.</span> <span class="toc-text">CentOS 7 安装步骤</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CentOS-安装-Hyperic"><span class="toc-number">2.</span> <span class="toc-text">CentOS 安装 Hyperic</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#安装过程"><span class="toc-number">2.1.</span> <span class="toc-text">安装过程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#安装PostgreSQL"><span class="toc-number">2.1.1.</span> <span class="toc-text">安装PostgreSQL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#hyperic用户和用户组"><span class="toc-number">2.1.2.</span> <span class="toc-text">hyperic用户和用户组</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#新建HQ数据库"><span class="toc-number">2.1.3.</span> <span class="toc-text">新建HQ数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#安装Hyperic"><span class="toc-number">2.1.4.</span> <span class="toc-text">安装Hyperic</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#启动Hyperic服务"><span class="toc-number">2.1.5.</span> <span class="toc-text">启动Hyperic服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#修改hyperic密码"><span class="toc-number">2.1.6.</span> <span class="toc-text">修改hyperic密码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#邮件配置"><span class="toc-number">2.1.7.</span> <span class="toc-text">邮件配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Sever端重启"><span class="toc-number">2.1.8.</span> <span class="toc-text">Sever端重启</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CentOS安装Hyperic商业版"><span class="toc-number">3.</span> <span class="toc-text">CentOS安装Hyperic商业版</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CentOS升级Hyperic版本"><span class="toc-number">4.</span> <span class="toc-text">CentOS升级Hyperic版本</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#服务端升级"><span class="toc-number">4.1.</span> <span class="toc-text">服务端升级</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#备份"><span class="toc-number">4.1.1.</span> <span class="toc-text">备份</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#将安装包解压到目录"><span class="toc-number">4.1.2.</span> <span class="toc-text">将安装包解压到目录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#原版本位置指定"><span class="toc-number">4.1.3.</span> <span class="toc-text">原版本位置指定</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#安装成功"><span class="toc-number">4.1.4.</span> <span class="toc-text">安装成功</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#重新启动"><span class="toc-number">4.1.5.</span> <span class="toc-text">重新启动</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#说明"><span class="toc-number">4.1.6.</span> <span class="toc-text">说明</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#客户端升级"><span class="toc-number">4.2.</span> <span class="toc-text">客户端升级</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hyperic实现数据库记录定时检查"><span class="toc-number">5.</span> <span class="toc-text">hyperic实现数据库记录定时检查</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#需求描述"><span class="toc-number">5.1.</span> <span class="toc-text">需求描述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#需求分析"><span class="toc-number">5.2.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#需求实现"><span class="toc-number">5.3.</span> <span class="toc-text">需求实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#脚本定时执行"><span class="toc-number">5.3.1.</span> <span class="toc-text">脚本定时执行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#脚本执行结果检查"><span class="toc-number">5.3.2.</span> <span class="toc-text">脚本执行结果检查</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#检测脚本-部分"><span class="toc-number">5.3.3.</span> <span class="toc-text">检测脚本(部分)</span></a></li></ol></li></ol></li></ol></div></div><div class="post-content"><figure class="highlight lsl"><table><tr><td class="code"><pre><span class="line">本文是 <span class="number">2015</span> 年写的，Hyperic相关文章的汇总。</span><br></pre></td></tr></table></figure>
<h2 id="CentOS-安装-PostgreSQL"><a href="#CentOS-安装-PostgreSQL" class="headerlink" title="CentOS 安装 PostgreSQL"></a>CentOS 安装 PostgreSQL</h2><p>hyperic使用PostgreSQL作为系统后台数据库</p>
<h3 id="CentOS-6-安装步骤"><a href="#CentOS-6-安装步骤" class="headerlink" title="CentOS 6 安装步骤"></a>CentOS 6 安装步骤</h3><h4 id="下载安装rpm文件"><a href="#下载安装rpm文件" class="headerlink" title="下载安装rpm文件"></a>下载安装rpm文件</h4><figure class="highlight subunit"><table><tr><td class="code"><pre><span class="line">wget http://yum.postgresql.org/9.1/redhat/rhel<span class="string">-6</span>.5-x86_64/pgdg-centos91<span class="string">-9</span>.1<span class="string">-4</span>.noarch.rpm</span><br><span class="line">yum install pgdg-centos91<span class="string">-9</span>.1<span class="string">-4</span>.noarch.rpm</span><br></pre></td></tr></table></figure>
<h4 id="安装PostgreSQL服务"><a href="#安装PostgreSQL服务" class="headerlink" title="安装PostgreSQL服务"></a>安装PostgreSQL服务</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> postgresql91-<span class="keyword">server</span></span><br></pre></td></tr></table></figure>
<h4 id="安装PostgreSQL-contrib模块"><a href="#安装PostgreSQL-contrib模块" class="headerlink" title="安装PostgreSQL contrib模块"></a>安装PostgreSQL contrib模块</h4><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> postgresql91-contrib</span><br></pre></td></tr></table></figure>
<h4 id="初始化数据库"><a href="#初始化数据库" class="headerlink" title="初始化数据库"></a>初始化数据库</h4><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">service</span> <span class="selector-tag">postgresql-9</span><span class="selector-class">.1</span> <span class="selector-tag">initdb</span></span><br></pre></td></tr></table></figure>
<h3 id="安装后操作"><a href="#安装后操作" class="headerlink" title="安装后操作"></a>安装后操作</h3><p>可执行文件  /usr/pgsql-9.1</p>
<p>配置文件和数据文件  /var/lib/pgsql/9.1</p>
<p>启停服务命令</p>
<figure class="highlight coq"><table><tr><td class="code"><pre><span class="line">/etc/init.d/postgresql<span class="number">-9.1</span> start|<span class="type">stop</span>|<span class="type">restart</span></span><br></pre></td></tr></table></figure>
<p>变更访问权限</p>
<p>修改/var/lib/pgsql/9.1/data/pg_hba.conf，重启服务</p>
<figure class="highlight oxygene"><table><tr><td class="code"><pre><span class="line"># <span class="keyword">TYPE</span>  DATABASE        USER            ADDRESS                 <span class="function"><span class="keyword">METHOD</span></span></span><br><span class="line"><span class="function"># "<span class="title">local</span>" <span class="title">is</span> <span class="title">for</span> <span class="title">Unix</span> <span class="title">domain</span> <span class="title">socket</span> <span class="title">connections</span> <span class="title">only</span></span></span><br><span class="line"><span class="function"><span class="title">local</span>   <span class="title">all</span>             <span class="title">all</span>                                     <span class="title">trust</span></span></span><br><span class="line"><span class="function"><span class="title">host</span>    <span class="title">all</span>             <span class="title">all</span>             0.0.0.0/0               <span class="title">password</span></span></span><br></pre></td></tr></table></figure>
<h3 id="CentOS-7-安装步骤"><a href="#CentOS-7-安装步骤" class="headerlink" title="CentOS 7 安装步骤"></a>CentOS 7 安装步骤</h3><p>yum方式安装</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> －y postgresql-<span class="keyword">server</span> postgresql-contrib</span><br></pre></td></tr></table></figure>
<p>初始化</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">postgresql-<span class="built_in">setup</span> initdb</span><br></pre></td></tr></table></figure>
<p>修改鉴权配置</p>
<figure class="highlight crystal"><table><tr><td class="code"><pre><span class="line">vim /var/<span class="class"><span class="keyword">lib</span>/<span class="title">pgsql</span>/<span class="title">data</span>/<span class="title">pg_hba</span>.<span class="title">conf</span></span></span><br></pre></td></tr></table></figure>
<p>启动数据库</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">systemctl <span class="literal">start</span> postgresql</span><br></pre></td></tr></table></figure>
<p>开机自启动</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">systemctl <span class="builtin-name">enable</span> postgresql</span><br></pre></td></tr></table></figure>
<h2 id="CentOS-安装-Hyperic"><a href="#CentOS-安装-Hyperic" class="headerlink" title="CentOS 安装 Hyperic"></a>CentOS 安装 Hyperic</h2><p>CentOS版本6.5</p>
<p>Hyperic版本5.8.2</p>
<h3 id="安装过程"><a href="#安装过程" class="headerlink" title="安装过程"></a>安装过程</h3><h4 id="安装PostgreSQL"><a href="#安装PostgreSQL" class="headerlink" title="安装PostgreSQL"></a>安装PostgreSQL</h4><p>参考上面</p>
<h4 id="hyperic用户和用户组"><a href="#hyperic用户和用户组" class="headerlink" title="hyperic用户和用户组"></a>hyperic用户和用户组</h4><figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">groupadd hyperic</span></span><br><span class="line"><span class="attribute">useradd -g hyperic hyperic</span></span><br></pre></td></tr></table></figure>
<h4 id="新建HQ数据库"><a href="#新建HQ数据库" class="headerlink" title="新建HQ数据库"></a>新建HQ数据库</h4><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">切换到PostgreSQL账户下</span><br><span class="line">su postgres</span><br><span class="line">登录数据库（此处依赖前面修改的PostgreSQL数据库配置，需开启本地账户免鉴权）</span><br><span class="line">psql</span><br><span class="line">执行新建用户和新建数据库命令</span><br><span class="line">CREATE USER hqadmin WITH ENCRYPTED PASSWORD <span class="string">'hqadmin'</span>;</span><br><span class="line">返回：CREATED ROLE</span><br><span class="line">CREATE DATABASE <span class="string">"HQ"</span> OWNER hqadmin ENCODING <span class="string">'UTF8'</span>;</span><br><span class="line">返回：CREATED DB</span><br><span class="line">(请注意标点符号的格式，复制后可能会出现变化)</span><br><span class="line">退出数据库</span><br><span class="line">control+D</span><br><span class="line">退出PostgreSQL账户</span><br><span class="line"><span class="keyword">exit</span></span><br></pre></td></tr></table></figure>
<h4 id="安装Hyperic"><a href="#安装Hyperic" class="headerlink" title="安装Hyperic"></a>安装Hyperic</h4><figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">将Hyperic安装包复制到hyperic用户目录下</span><br><span class="line">将账户切换到hyperic</span><br><span class="line">su hyperic</span><br><span class="line">解压缩Hyperic安装包</span><br><span class="line">tar -zxvf 安装包</span><br><span class="line">进入解压后的目录，执行安装命令./<span class="built_in">setup</span>.sh -full</span><br><span class="line">安装目录选择/<span class="built_in">home</span>/hyperic</span><br><span class="line">选择数据库，<span class="number">2</span>，PostgreSQL</span><br></pre></td></tr></table></figure>
<h4 id="启动Hyperic服务"><a href="#启动Hyperic服务" class="headerlink" title="启动Hyperic服务"></a>启动Hyperic服务</h4><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/home/</span>hyperic<span class="regexp">/server-5.8.2/</span>bin<span class="regexp">/hq-server.sh start</span></span><br></pre></td></tr></table></figure>
<h4 id="修改hyperic密码"><a href="#修改hyperic密码" class="headerlink" title="修改hyperic密码"></a>修改hyperic密码</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">安装过程中，要求输入管理员账户的密码，后续添加监控节点时，每次都需要输入该密码</span><br><span class="line">安装完成后，在管理系统中，可以修改该密码，监控节点会自动更新</span><br><span class="line">注意密码不要带特殊字符，否则会导致监控节点无法添加</span><br></pre></td></tr></table></figure>
<h4 id="邮件配置"><a href="#邮件配置" class="headerlink" title="邮件配置"></a>邮件配置</h4><p>发件人配置修改<br><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">Administration-HQ<span class="built_in"> Server </span>Setting-Email Configuration Properties</span><br><span class="line"><span class="keyword">From</span> Email Address:xxx@xxx.com</span><br></pre></td></tr></table></figure></p>
<p>服务器配置文件修改</p>
<figure class="highlight clean"><table><tr><td class="code"><pre><span class="line">################################################################################</span><br><span class="line"># Email Settings</span><br><span class="line">################################################################################</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># Property: server.mail.host</span><br><span class="line">#</span><br><span class="line"># The IP or hostname <span class="keyword">of</span> the SMTP server that the HQ server will use for sending</span><br><span class="line"># alerts and other HQ-related emails. Most UNIX platforms have a local SMTP</span><br><span class="line"># server, <span class="keyword">in</span> which <span class="keyword">case</span> localhost or <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> can be used here.</span><br><span class="line">#server.mail.host=<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">server.mail.host=xxx.exmail.xxx.com</span><br><span class="line">mail.user=xxx@xxx.com</span><br><span class="line">mail.password=xxxxx</span><br><span class="line">mail.smtp.port=<span class="number">25</span></span><br><span class="line">mail.smtp.auth=true</span><br><span class="line">mail.smtp.socketFactory.<span class="keyword">class</span>=javax.net.SocketFactory</span><br><span class="line">mail.smtp.socketFactory.fallback=false</span><br><span class="line">mail.smtp.socketFactory.port=<span class="number">25</span></span><br><span class="line">mail.smtp.starttls.enable=true</span><br></pre></td></tr></table></figure>
<p>收件人配置</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">管理页面</span><br><span class="line">Administration-Authentication/Authorization-List Users</span><br><span class="line">修改收件人Email地址</span><br></pre></td></tr></table></figure>
<h4 id="Sever端重启"><a href="#Sever端重启" class="headerlink" title="Sever端重启"></a>Sever端重启</h4><p>使用bin/hq-server.sh restart重启。</p>
<p>若使用外部数据库，建议将数据库同时重启，否则可能会导致服务启动异常。</p>
<h2 id="CentOS安装Hyperic商业版"><a href="#CentOS安装Hyperic商业版" class="headerlink" title="CentOS安装Hyperic商业版"></a>CentOS安装Hyperic商业版</h2><p>整体安装过程同开源版本大同小异。</p>
<p>安装过程中要求选择安装规模，小型、中型、大型，选择不同规模，对于服务器性能要求不同，特别是内存，如果选择大型，而内存不足，会直接导致服务端程序无法启动。</p>
<p>商业版免费使用60天，限制客户端数量为60个，通过修改配置文件安装key。</p>
<p>配置文件位置：/home/hyperic/server-5.8.0-EE/conf/hq-server.conf</p>
<p>授权文件：vCenter Operations Management Suite Enterprise Plus Edition</p>
<figure class="highlight vala"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># Property vcops.license.key</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># This property defines the license key for</span></span><br><span class="line"><span class="meta"># vCenter Operations Management Suite Enterprise Plus Edition</span></span><br><span class="line">vcops.license.key=XXXXX-XXXXX-XXXXX-XXXXX-XXXXX</span><br></pre></td></tr></table></figure>
<p>安装Hyperic商业版，应使用自建数据库，不建议使用内建数据库，否则安装完成后，管理页面上会存在橙色字体提示如下：</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">The Hyperic built-<span class="keyword">in</span> database <span class="keyword">is</span> provided <span class="keyword">for</span> EVALUATION PURPOSES ONLY. <span class="keyword">For</span> production purposes <span class="keyword">use</span> vPostgreSQL.</span><br></pre></td></tr></table></figure>
<h2 id="CentOS升级Hyperic版本"><a href="#CentOS升级Hyperic版本" class="headerlink" title="CentOS升级Hyperic版本"></a>CentOS升级Hyperic版本</h2><p>原版本：hyperic-hqee-installer-x86-64-linux-5.8.0</p>
<p>新版本：hyperic-hqee-installer-x86-64-linux-5.8.3</p>
<p>操作系统版本：CentOS 6.5</p>
<p>数据库版本：PostgreSQL 9.1</p>
<h3 id="服务端升级"><a href="#服务端升级" class="headerlink" title="服务端升级"></a>服务端升级</h3><h4 id="备份"><a href="#备份" class="headerlink" title="备份"></a>备份</h4><p>管理中心文件备份</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">tar</span> <span class="selector-tag">-zcvf</span> <span class="selector-tag">server-5</span><span class="selector-class">.8</span><span class="selector-class">.0-EE</span><span class="selector-class">.tgz</span> <span class="selector-tag">server-5</span><span class="selector-class">.8</span><span class="selector-class">.0-EE</span></span><br></pre></td></tr></table></figure>
<p>数据库备份</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">su postgres</span><br><span class="line">pg_dump HQ &gt;<span class="regexp">/tmp/</span>HQ_20141210.dmp</span><br></pre></td></tr></table></figure>
<h4 id="将安装包解压到目录"><a href="#将安装包解压到目录" class="headerlink" title="将安装包解压到目录"></a>将安装包解压到目录</h4><figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">./setup.sh -upgrade</span><br><span class="line">协议确认</span><br><span class="line"><span class="keyword">Do</span> you <span class="keyword">accept</span> the terms <span class="keyword">of</span> the agreement? (y, n)</span><br><span class="line">y</span><br></pre></td></tr></table></figure>
<h4 id="原版本位置指定"><a href="#原版本位置指定" class="headerlink" title="原版本位置指定"></a>原版本位置指定</h4><figure class="highlight axapta"><table><tr><td class="code"><pre><span class="line">Enter current installation path of HQ <span class="keyword">server</span> to upgrade: [<span class="keyword">default</span> <span class="string">''</span>]:</span><br><span class="line">/home/hyperic/<span class="keyword">server</span><span class="number">-5.8</span><span class="number">.0</span>-EE</span><br><span class="line">新版本位置指定</span><br><span class="line">Enter <span class="keyword">new</span> HQ <span class="keyword">server</span> directory [<span class="keyword">default</span> <span class="string">'/home/hyperic'</span>]:</span><br></pre></td></tr></table></figure>
<h4 id="安装成功"><a href="#安装成功" class="headerlink" title="安装成功"></a>安装成功</h4><figure class="highlight vbscript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Server</span> successfully upgraded <span class="keyword">to</span>: /home/hyperic/<span class="built_in">server</span><span class="number">-5.8</span><span class="number">.3</span>-EE</span><br></pre></td></tr></table></figure>
<h4 id="重新启动"><a href="#重新启动" class="headerlink" title="重新启动"></a>重新启动</h4><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">You can now start your HQ<span class="built_in"> server </span>by running this command:</span><br><span class="line">/home/hyperic/server-5.8.3-EE/bin/hq-server.sh start</span><br><span class="line">启动前最好重启一下PostgreSQL</span><br></pre></td></tr></table></figure>
<h4 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h4><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">Note that the first time the HQ<span class="built_in"> server </span>starts up it may take several minutes <span class="keyword">to</span> initialize. Subsequent startups will be much faster.</span><br></pre></td></tr></table></figure>
<h3 id="客户端升级"><a href="#客户端升级" class="headerlink" title="客户端升级"></a>客户端升级</h3><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">管理系统———主机——hyperic HQ agent——Views——agent commands——<span class="builtin-name">run</span> upgrade</span><br><span class="line">将所有Agent归为一组，通过Views统一下达指令，可同时完成升级操作</span><br></pre></td></tr></table></figure>
<p>经过实践，通过上述方式操作，会导致服务器上出现两个agent进程，主体功能正常，部分功能存在问题。<br>此时通过Web控制重启Agent失败。<br>建议方便的时候，手动在服务器上重启Agent进程。</p>
<h2 id="hyperic实现数据库记录定时检查"><a href="#hyperic实现数据库记录定时检查" class="headerlink" title="hyperic实现数据库记录定时检查"></a>hyperic实现数据库记录定时检查</h2><p>hyperic版本：5.8.3 商业版</p>
<p>python版本：2.6.6</p>
<p>操作系统：CentOS 6.5</p>
<h3 id="需求描述"><a href="#需求描述" class="headerlink" title="需求描述"></a>需求描述</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">现网资源每周一更新，通过执行脚本，检查数据库中栏目资源，如果发现周一未更新，则发出告警。</span><br><span class="line">数据库中有多个栏目，要求所有栏目全部更新。</span><br></pre></td></tr></table></figure>
<h3 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">脚本定时执行，根据执行结果告警。</span><br><span class="line">每次的执行结果均有记录，可回溯。</span><br><span class="line">栏目资源表中没有时间戳，需要分析每个栏目的资源ID的变化，判断是否更新。</span><br></pre></td></tr></table></figure>
<h3 id="需求实现"><a href="#需求实现" class="headerlink" title="需求实现"></a>需求实现</h3><h4 id="脚本定时执行"><a href="#脚本定时执行" class="headerlink" title="脚本定时执行"></a>脚本定时执行</h4><figure class="highlight mathematica"><table><tr><td class="code"><pre><span class="line">新建FileServer <span class="keyword">File</span></span><br><span class="line">进入hyperic配置界面，选择platform——Tools <span class="keyword">Menu</span>——New Platform Service——新建FileServer <span class="keyword">File</span>类型</span><br><span class="line">配置脚本路径</span><br><span class="line">Inventory——Configuration <span class="keyword">Properties</span>——path</span><br><span class="line">测试脚本是否正常</span><br><span class="line"><span class="keyword">Control</span>——Quick <span class="keyword">Control</span>——<span class="keyword">Control</span> Action:run 检查脚本执行是否正常</span><br><span class="line">配置定时任务</span><br><span class="line"><span class="keyword">Control</span> Action Schedule——new Schedule</span><br><span class="line">可实现每天、每周、每月的定时执行，或者一次性执行</span><br></pre></td></tr></table></figure>
<h4 id="脚本执行结果检查"><a href="#脚本执行结果检查" class="headerlink" title="脚本执行结果检查"></a>脚本执行结果检查</h4><figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">通过上述配置，FileServer <span class="built_in">File</span>类型无法判断脚本执行结果，从而无法实现告警</span><br><span class="line">在脚本中新建一个标志文件，当脚本执行正常时，文件是存在的，若脚本执行异常，直接将此文件删除</span><br><span class="line">再新建一个FileServer <span class="built_in">File</span>类型，继续监测标志文件是否存在，若不存在，则告警</span><br></pre></td></tr></table></figure>
<h4 id="检测脚本-部分"><a href="#检测脚本-部分" class="headerlink" title="检测脚本(部分)"></a>检测脚本(部分)</h4><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    </span><br><span class="line">    try:</span><br><span class="line">        </span><br><span class="line">        <span class="comment">#检查标志文件是否存在，若不存在，则新建</span></span><br><span class="line">        <span class="keyword">if</span> os.path.exists(<span class="string">'tag'</span>):</span><br><span class="line">            pass</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            f = open(<span class="string">'tag'</span>, <span class="string">'w'</span>)</span><br><span class="line">            f.close()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">#业务逻辑</span></span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        <span class="comment">#检测失败，删除标志文件</span></span><br><span class="line">        print <span class="number">1</span></span><br><span class="line">        os.remove(<span class="string">'tag'</span>)</span><br><span class="line">        sys.<span class="keyword">exit</span>(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    except Exception,e:</span><br><span class="line">        print <span class="number">9</span></span><br></pre></td></tr></table></figure>
</div><div class="tags"><a href="/tags/Hyperic/">Hyperic</a></div><div class="post-nav"><a class="pre" href="/2018/11/08/git清理历史文件/">git操作方法汇总</a><a class="next" href="/2018/11/08/CentOS安装DNS双机/">CentOS安装DNS双机</a></div><div id="container"></div><link rel="stylesheet" type="text/css" href="//unpkg.com/gitalk/dist/gitalk.css?v=0.0.3"><script type="text/javascript" src="//cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.js?v=0.0.3"></script><script type="text/javascript" src="//unpkg.com/gitalk/dist/gitalk.min.js?v=0.0.3"></script><script>var gitalk = new Gitalk({
  clientID: '006e5f00ed97113fdd82',
  clientSecret: 'cf1e215058deb82e58b4bca24cc79b7011427033',
  repo: 'gitment-comments',
  owner: 'zhuwanjun2008',
  admin: ['zhuwanjun2008'],
  id: md5(location.pathname),
  distractionFreeMode: false
})
gitalk.render('container')
</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Nginx/" style="font-size: 15px;">Nginx</a> <a href="/tags/CentOS/" style="font-size: 15px;">CentOS</a> <a href="/tags/Rsync/" style="font-size: 15px;">Rsync</a> <a href="/tags/Gitoite/" style="font-size: 15px;">Gitoite</a> <a href="/tags/Haproxy/" style="font-size: 15px;">Haproxy</a> <a href="/tags/Keepalived/" style="font-size: 15px;">Keepalived</a> <a href="/tags/Mongodb/" style="font-size: 15px;">Mongodb</a> <a href="/tags/Mysql/" style="font-size: 15px;">Mysql</a> <a href="/tags/OpenVPN/" style="font-size: 15px;">OpenVPN</a> <a href="/tags/OpenResty/" style="font-size: 15px;">OpenResty</a> <a href="/tags/DNS/" style="font-size: 15px;">DNS</a> <a href="/tags/PPTP/" style="font-size: 15px;">PPTP</a> <a href="/tags/vsftpd/" style="font-size: 15px;">vsftpd</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/Outlook/" style="font-size: 15px;">Outlook</a> <a href="/tags/Hyperic/" style="font-size: 15px;">Hyperic</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/Redis/" style="font-size: 15px;">Redis</a> <a href="/tags/堡垒机/" style="font-size: 15px;">堡垒机</a> <a href="/tags/阿里云/" style="font-size: 15px;">阿里云</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/11/08/git清理历史文件/">git操作方法汇总</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/08/git操作方法汇总/">Hyperic文章汇总</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/08/CentOS安装DNS双机/">CentOS安装DNS双机</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/08/Python操作数据库两例/">Python操作数据库两例</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/07/CentOS安装vsftpd/">CentOS安装vsftpd</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/07/北京，北京/">北京，北京</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/07/Redis高可用双机部署/">Redis高可用双机部署</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/07/Centos修改用户进程限制参数/">Centos修改用户进程限制参数</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/07/运维堡垒机文章汇总/">运维堡垒机文章汇总</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/06/CentOS限制sftp用户访问目录/">CentOS限制sftp用户访问目录</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">万骏的博客.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.3" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.3" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.3"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.3"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.3"></script></div></body></html>